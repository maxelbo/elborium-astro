---
import YTiframe from "@/components/YTiframe.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";

const pageTitle = "Blog";

export async function getStaticPaths({ paginate }) {
  const allPosts = await Astro.glob("./*.mdx");
  allPosts.sort(
    (a, b) =>
      Date.parse(b.frontmatter.pubDate) - Date.parse(a.frontmatter.pubDate)
  );
  return paginate(allPosts, { pageSize: 8 });
}

const { page } = Astro.props;
---

<BaseLayout pageTitle={pageTitle}>
  <section>
    <h1>{pageTitle}</h1>

    <div class="mx-auto max-w-6xl divide-y divide-gray-200">
      {
        page.data.map((post: any) => (
          <article class="mx-auto my-4 max-w-6xl space-y-4 py-4">
            {post.frontmatter.img.src0 && (
              <img src={post.frontmatter.img?.src0} />
            )}
            {post.frontmatter.img.src1 && (
              <img src={post.frontmatter.img?.src1} />
            )}
            {post.frontmatter.img.src2 && (
              <img src={post.frontmatter.img.src2} />
            )}
            {post.frontmatter.img.src3 && (
              <img src={post.frontmatter.img.src3} />
            )}
            {post.frontmatter.img.src4 && (
              <img src={post.frontmatter.img.src4} />
            )}
            {post.frontmatter.img.src5 && (
              <img src={post.frontmatter.img.src5} />
            )}
            {post.frontmatter.img.src6 && (
              <img src={post.frontmatter.img.src6} />
            )}
            {post.frontmatter.video && (
              <YTiframe video={post.frontmatter.video} />
            )}
            <div class="mx-auto my-4 max-w-2xl space-y-2">
              {post.frontmatter.body && (
                <p class="text-left">{post.frontmatter.body}</p>
              )}
              <p class="text-left text-sm text-gray-400">
                {new Intl.DateTimeFormat("en-US", {
                  dateStyle: "medium",
                }).format(new Date(post.frontmatter.pubDate))}
              </p>
            </div>
          </article>
        ))
      }
    </div>

    <div class="space-y-2 border-t-2 border-t-gray-200 pt-8">
      <div class="space-x-4 text-2xl">
        {page.url.prev ? <a href={page.url.prev}>&larr; Previous</a> : null}
        {page.url.next ? <a href={page.url.next}>Next &rarr;</a> : null}
      </div>
      <p class="-mt-2 text-gray-400">
        Page {page.currentPage} of {page.lastPage}
      </p>
    </div>
  </section>
  <h2 class="mt-16 capitalize">This is my work</h2>
</BaseLayout>

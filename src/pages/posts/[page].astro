---
import YTiframe from "@/components/YTiframe.astro";
import BaseLayout from "@/layouts/BaseLayout.astro";

const pageTitle = "Blog";

export async function getStaticPaths({ paginate }) {
  const allPosts = await Astro.glob("./*.mdx");
  return paginate(allPosts, { pageSize: 4 });
}

// TODO: sort by date and paginate
// allPosts.sort((a, b) => Date.parse(b.frontmatter.date) - Date.parse(a.frontmatter.date));

const { page } = Astro.props;
---

<BaseLayout pageTitle={pageTitle}>
  <section class="">
    <h1>{pageTitle}</h1>

    <div class="mx-auto max-w-6xl divide-y divide-gray-200">
      {
        page.data.map((post: any) => (
          <div class="mx-auto my-4 max-w-6xl space-y-4 py-4">
            {post.frontmatter.img.src && (
              <img src={post.frontmatter.img?.src} />
            )}
            {post.frontmatter.img.src2 && (
              <img src={post.frontmatter.img.src2} />
            )}
            {post.frontmatter.video && (
              <YTiframe video={post.frontmatter.video} />
            )}
            <div class="mx-auto my-4 max-w-3xl space-y-2">
              {post.frontmatter.body && (
                <p class="text-left">{post.frontmatter.body}</p>
              )}
              <p class="text-left text-gray-400">{post.frontmatter.pubDate}</p>
            </div>
          </div>
        ))
      }
    </div>

    <div>
      <div class="space-x-4">
        {page.url.prev ? <a href={page.url.prev}>{`< Previous`}</a> : null}
        {page.url.next ? <a href={page.url.next}>{`Next >`}</a> : null}
      </div>
      <p class="-mt-2 text-gray-400">
        {page.currentPage}/{page.lastPage}
      </p>
    </div>
  </section>
  <h2 class="mt-16">This is My Work</h2>
</BaseLayout>

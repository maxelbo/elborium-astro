---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Post from "@/components/Post.astro";

const pageTitle = "Blog";

export async function getStaticPaths({ paginate }) {
  // Fetch all posts
  const allPosts = await Astro.glob("./*.mdx");
  // Filter out drafts
  const pubPosts = allPosts.filter((post) => !post.frontmatter.draft);
  // Sort by date
  pubPosts.sort(
    (a, b) =>
      Date.parse(b.frontmatter.pubDate) - Date.parse(a.frontmatter.pubDate)
  );
  return paginate(pubPosts, { pageSize: 8 });
}

const { page } = Astro.props;
---

<BaseLayout pageTitle={pageTitle}>
  <section>
    <h1>This Is a {pageTitle} of Sorts</h1>

    <!-- Posts -->
    <div class="mx-auto max-w-6xl divide-y divide-gray-200">
      {page.data.map((post: any) => <Post post={post} />)}
    </div>

    <!-- Pagination -->
    <div class="space-y-2 border-t-2 border-t-gray-200 pt-8">
      <div class="space-x-4 text-2xl">
        {page.url.prev ? <a href={page.url.prev}>&larr; Future</a> : null}
        {page.url.next ? <a href={page.url.next}>Past &rarr;</a> : null}
      </div>
      <p class="-mt-2 text-gray-400">
        Page {page.currentPage} of {page.lastPage}
      </p>
    </div>
  </section>

  <h2 class="mt-16 capitalize">This is my work</h2>
</BaseLayout>
